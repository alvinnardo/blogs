---
title: postgres_000
date: 2025-03-06 11:19:34
tags:
---

# 背景描述

1. 通过学习 Postgres 源码，精通数据库常见技术

2. 正式从头开始读工程源码，总结学习源码工程的一般方法，为以后读其它工程源码总结经验

3. 使用学习的技术和当今较新的技术实现自己的数据库程序
   
   

# 方法

- 从头开始 commit
  
  - 从第一个提交开始，从头学习，了解软件的演变历史，对代码有更为感性的认识；

- 文件结构 file structure
  
  - 主要关注 backend 和 bin 两个文件夹，backend 是数据库主要功能实现代码所在位置，bin 是生成二进制命令的代码所在位置；

- 工程架构 architecture
  
  - C/S 模型
    
    - 客户端连接服务端，在客户端键入 SQL，发送给服务端处理执行，将结果返回给客户端
  
  - 进程结构（CPU）
    
    - Postmaster 进程：守护进程，接收用户的连接请求，并分配服务进程
    
    - 后端服务进程：一个客户端连接分配一个后端服务进程，用于执行用户的 SQL
  
  - 内存结构（内存）
    
    - 磁盘缓冲区：将磁盘中的常用的数据存放在内存中
    
    - 工作内存：执行排序、分组时使用的内存
    
    - 其它缓存：比如缓存执行计划，遇到相同的 SQL，可以在缓存中查找计划
  
  - 存储管理（磁盘）
    
    -  表和索引存储
    
    - 日志管理：WAL 预写日志，用于异常情况下的数据重放
  
  - 查询处理
    
    - 解析 => 分析 => 优化 => 执行

- 代码结构 code structure
  
  - 代码主要使用 C 语言写成，使用 make 编译
  
  - C 语言更贴近机器，对于数据库这种追求效率的软件来说，C 语言更能提升效率，但有内存不安全的问题。
  
  - Makefile 的编写较为复杂，可以使用 cmake 改写。最新版本的 PG 已经使用了 Meson 进行代码编译管理。

- 函数功能 function
  
  - 在每个提交上，对主要函数功能进行分析。
